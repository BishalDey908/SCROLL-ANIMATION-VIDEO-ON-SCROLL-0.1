<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scroll Video Animation</title>

  <!-- Tailwind -->
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/ScrollTrigger.min.js"></script>
</head>

<body class="bg-zinc-900">

  <!-- WRAPPER -->
  <div class="w-full">
    <div class="parent relative w-full h-[700vh] bg-zinc-800">

      <!-- STICKY CANVAS -->
      <div class="sticky top-0 left-0 w-full h-screen">
        <canvas id="frame" class="w-full h-screen"></canvas>
      </div>

    </div>
  </div>

  <script>
    gsap.registerPlugin(ScrollTrigger)

    /* ================= CONFIG ================= */
    const frames = {
      currentIndex: 0,
      maxIndex: 381
    }

    const images = []
    let imagesLoaded = 0

    const canvas = document.getElementById("frame")
    const context = canvas.getContext("2d")

    /* ================= RESIZE ================= */
    function resizeCanvas() {
      canvas.width = window.innerWidth
      canvas.height = window.innerHeight
    }
    resizeCanvas()
    window.addEventListener("resize", resizeCanvas)

    /* ================= PRELOAD ================= */
    function preloadImages() {
      for (let i = 0; i <= frames.maxIndex; i++) {
        const img = new Image()
        img.src = `./video-frames/frame_${(i + 1).toString().padStart(4, "0")}.jpeg`
        img.onload = () => {
          imagesLoaded++
          if (imagesLoaded === frames.maxIndex + 1) {
            loadImage(0)
            startAnimation()
          }
        }
        images.push(img)
      }
    }

    /* ================= DRAW IMAGE ================= */
    function loadImage(index) {
      const img = images[index]
      if (!img) return

      context.clearRect(0, 0, canvas.width, canvas.height)

      const scaleX = canvas.width / img.width
      const scaleY = canvas.height / img.height
      const scale = Math.max(scaleX, scaleY)

      const newWidth = img.width * scale
      const newHeight = img.height * scale

      const offsetX = (canvas.width - newWidth) / 2
      const offsetY = (canvas.height - newHeight) / 2

      context.imageSmoothingEnabled = true
      context.imageSmoothingQuality = "high"

      context.drawImage(img, offsetX, offsetY, newWidth, newHeight)

      frames.currentIndex = index
    }

    /* ================= GSAP SCROLL ================= */
    function startAnimation() {
      gsap.timeline({
        scrollTrigger: {
          trigger: ".parent",
          start: "top top",
          end: "bottom bottom",
          scrub: 2,
          markers: true
        }
      }).to(frames, {
        currentIndex: frames.maxIndex,
        ease: "none",
        onUpdate: () => {
          loadImage(Math.floor(frames.currentIndex))
        }
      })
    }

    /* ================= INIT ================= */
    preloadImages()
  </script>

</body>
</html>
